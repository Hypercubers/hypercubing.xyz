# Grip Theory

Grip theory is a framework for analyzing many different kinds of twisty puzzles in a geometry-independent way. It was first developed on the TwistyPuzzles forum in 2009 in [this thread](https://twistypuzzles.com/forum/viewtopic.php?f=1&t=15667). Grip theory was originally used to describe doctrinaire puzzles in 3D, but it can be extended to describe bandaged puzzles, jumbling puzzles, higher-dimensional puzzles, and more.

## Basic grip theory

### The 3×3×3

Consider a cube in 3-dimensional euclidean space. Rotations of this 3-dimensional space form a [group](https://en.wikipedia.org/wiki/Group_(mathematics)): [$SO(3)$](https://en.wikipedia.org/wiki/3D_rotation_group). This group is said to be [acting on](https://en.wikipedia.org/wiki/Group_action) the 3D space. Consider a subset of these rotations that sends the cube to itself. These rotations form [a subgroup of order 24](https://en.wikipedia.org/wiki/Octahedral_symmetry), which is isomorphic to the symmetric group $S_4$, although it goes by [many other names](https://people.maths.bris.ac.uk/~matyd/GroupNames/1/S4.html). To see how this subgroup acts on the cube, we can define the 6 sides of the cube (as subsets of 3D space), and label them e.g. $R$, $U$, $F$, $L$, $D$, and $B$. Because we restricted our attention to rotations that preserve the cube, the image of any side under any rotation will always also be one of the sides. Thus we can define an action of the group on the 6-element set of sides $\{R, U, F, L, D, B\}$.

A piece of the [3×3×3](/puzzles/3x3x3.md) can be thought of as a subset of the cube, and it is incident with one or more of its faces. Corners are incident with 3 faces, edges with 2, centers with 1, and the core with 0. At any time each piece has 3 important properties:

- Set of faces with which it was incident when solved. This defines which piece it is, and is reflected in e.g. the stickers that are on the piece.
- An element of the aforementioned rotation group which sends the piece from its solved state to its current state.
- Set of faces with which the piece is incident now. This determines whether the piece moves or not when a particular twist is performed.

These properties are redundant: suppose we call these $X, g, Y$ respectively. Then $Y = \{ x \cdot g \mid x \in X\}$, or simply $Y = X \cdot g$; and likewise and $X = Y \cdot g^{-1}$.

When we perform a twist, we choose a face $f$, and a rotation $r$ of the cube that sends the chosen face to itself: $f \cdot r = f$. Then for each piece one of two things happen:

- If the piece is currently incident with $f$, it gets acted on by $r$, sending $(X, g, Y) \mapsto (X, gr, Y \cdot r)$.
- If the piece is currently not incident with $f$, it remains unchanged.

For example when we do an `R` twist, it's as if the pieces currently incident with the $R$ face underwent an `x` cube rotation, and other pieces remained static.

Note that when twisting around $f$, we didn't change whether any piece is incident with $f$, meaning the twist can be inverted by using the same face $f$ and the rotation $r^{-1}$.

### The grips of the 3×3×3

Instead of working with geometric shapes embedded in 3D space, we can work with abstract sets. Consider a set $\Gamma$ of 6 abstract objects, called *grips*:

$$\Gamma = \{R, U, F, L, D, B\}.$$

Next consider a group acting on this set, generated by two 4-cycles that cycle $F, U, B, D$, and $R, F, L, B$ respectively. More precisely, we mean the subgroup $G$ of $S_\Gamma$ generated by $(F,U,B,D)$ and $(R,F,L,B)$. We will call this the *grip group*. This group and its action are isomorphic to the rotations of the cube and their action on the 6 faces we defined above.

A *piece* is identified by a set $X \subseteq \Gamma$ -- the *set of solved grips*. At any time a piece has some *attitude* $g$, which is an element of the grip group $G$. From that we can also compute the *set of active grips*, which is defined to be $Y = X \cdot g$. The grip group acts on the piece like so:

$$(X, g, Y) \cdot r = (X, gr, Y \cdot r),$$

so the active grips follow the piece.

The attitude of a piece with active grip set $Y$ can be decomposed into two components: the *orientation* of the piece, which is an element of the [stabilizer subgroup](https://en.wikipedia.org/wiki/Group_action#Orbits_and_stabilizers) $\operatorname{Stab}(Y)$; and the *position*, which is the set of active grips $Y$ itself. By the [orbit-stabilizer theorem](https://en.wikipedia.org/wiki/Group_action#Orbit-stabilizer_theorem) we can identify the orbit $X \cdot G$ (the possible positions of this piece) with the cosets in $G / \operatorname{Stab}(Y)$.

For example, $(\{R, U\}, (U,R)(L,D)(F,B), \{R, U\})$ is an abstract description of the up-right edge in its solved position, but wrong orientation. We can verify its set of active grips:

$$\{R, U\} \cdot (U,R)(L,D)(F,B) = \{R, U\}.$$

Note that the groups $\operatorname{Stab}(X)$ and $\operatorname{Stab}(X \cdot g) = \operatorname{Stab}(Y)$ are conjugate, and thus isomorphic, and in general we have a [fiber bundle](https://en.wikipedia.org/wiki/Fiber_bundle):

$$\operatorname{Stab}(X) \hookrightarrow G \rightarrow G / \operatorname{Stab}(X).$$

Next, define a *twist* to be a pair of: a grip $f$ we twist around, or *axis*, and element of $\operatorname{Stab}(f)$, the *transformation*. Equivalently, we can choose an arbitrary transformation $r \in G$ first, and then an axis $f$ from the set $\Gamma^r$ of fixed points of $r$. As before, the action of a twist $(f, r)$ on a piece is:

$$(X, g, Y) \mapsto \begin{cases}
(X, gr, Y \cdot r), & \text{if } f \in X \cdot g, \\
(X, g, Y), & \text{if } f \notin X \cdot g. \\
\end{cases}$$

For instance, applying the twist with axis $U$ and transformation $(R,F,L,B)$, which fixes $U$, to the piece from above, we get a new attitude

$$(U,R)(L,D)(F,B) * (R,F,L,B) = (R,U,F)(L,D,B),$$

and a new active grip set

$$\{U, R\} \cdot (R,F,L,B) = \{U, F\}.$$

The set of all positions our piece can move to are all sets of two grips except $\{R, L\}$, $\{U, D\}$, and $\{F, B\}$. These exactly correspond to the edge positions of the 3×3×3. An edge piece is only affected by a twist if one of its colored faces is on the face corresponding to the axis of the twist, and after the twist, the positions of its colored faces moves. This is exactly the behavior of the active grips. Therefore, the piece above is an edge piece.

We can similarly construct three more sets of pieces: the corners, with active grips like $\{R, U, F\}$, the centers, with active grips like $\{R\}$, and the core, with empty active grip set. Note that even though the centers have only one grip, they still have attitude, so the centers on this puzzle are actually super centers.

### States

Above we have chosen some set of pieces $P$, a subset of $2^\Gamma$. Notably it is an invariant subset under the action of the grip group: $P \cdot G = P$. The state of the puzzle comprises of the states of all pieces, i.e. some set of triples $(X \in P, g \in G, Y \in P)$ such that $X \cdot g = Y$. This defines a relation between $P$, $P$, and $G$. Due to the redundancy, there are three ways to look at it:

- A function $X \mapsto g$, called $a$, indicating that the piece $X$ has attitude $a(X)$, and has active grips $Y(X) = X \cdot a(X)$.
- A function $Y \mapsto g$, also called $g$, indicating that the piece whose active grips are $Y$ has attitude $g(Y)$ and its solved grips were $X(Y) = Y \cdot g(Y)^{-1}$.
- A permutation of $X$'s into $Y$'s, $\pi : P \to P$, together with a choice of $g$ at each fiber such that $\pi(X) = X \cdot g$.

Denoting the set of such relations $G \wr P$, the first description allows us to straightforwardly define a group structure on it. If we treat elements of $G \wr P$ as functions from $P$ to $G$ in the first sense, then given $a, b \in G \wr P$, their product $ab$ is defined by:

$$ab(X) = a(X) b(X \cdot a(X)).$$

The second and third descriptions allow us to identify $G \wr P$ as a subgroup of the [wreath product](https://en.wikipedia.org/wiki/Wreath_product) $G \wr_P S_P$ (hence the notation). Indeed, suppose $g, h : P \to G$ are maps sending *active* grips to attitudes, and $\pi, \sigma \in S_P$ are permutations of pieces. Defining multiplication as:

$$(\pi, g) * (\sigma, h) = (\pi\sigma, Y \mapsto g(\sigma^{-1}(Y)) h(Y)),$$

we end up with the group structure of the semidirect product $S_P \rtimes G^P$, with the action of reindexing, i.e. exactly the wreath product $G \wr_P S_P$. The group $G \wr P$ is then the subgroup consisting of pairs $(\pi, g)$ that agree:

$$\forall X \in P, \pi(X) = X \cdot g(\pi(X)).$$

Note that the $\pi$'s are limited to those that preseve the orbits $P / G$, else there doesn't exist an agreeing $g$. The wreath product thus splits into a product of independent groups, one for each orbit. In turn, for a piece with active grips $Y$, the set of agreeing $g(Y)$'s is some coset of the stabilizer $\operatorname{Stab}(Y)$ in $G / \operatorname{Stab}(Y)$. Within an orbit, all these stabilizers are isomorphic, thus we can write $G \wr P$ as:

$$\prod_{O \in P / G} \operatorname{Stab}(Y \in O) \wr_O S_O,$$

provided we choose a designated element $Y$ in each orbit $O$, and an identification of $\operatorname{Stab}(Y)$ with its cosets.

For our 3×3×3, there are four orbits, corresponding to the four types of piece we defined above:

- 12 edges with stabilizers $\mathbb{Z}_2$,
- 8 corners with stabilizers $\mathbb{Z}_3$,
- 6 faces with stabilizers $\mathbb{Z}_4$,
- and 1 core with stabilizer $G$.

The group of puzzle states is thus:

$$(\mathbb{Z}_2 \wr S_{12}) \times (\mathbb{Z}_3 \wr S_8) \times (\mathbb{Z}_4 \wr S_6) \times (G \wr S_1).$$

### Twists

A twist acts on a piece, and thus can act on the puzzle state -- a set of pieces. Because the set of states $G \wr P$ admits a group structure, the action of a twist $(f, r)$ is actually equivalent to multiplication on the right by a certain element of $G \wr P$ -- the state you get if you apply the twist to the solved puzzle:

$$\pi(X) = \begin{cases}
X \cdot r, & \text{if } f \in X, \\
X, & \text{if } f \notin X; \\
\end{cases}$$

$$g(Y) = \begin{cases}
r, & \text{if } f \in Y, \\
1, & \text{if } f \notin Y. \\
\end{cases}$$

This defines a [group homomorphism](https://en.wikipedia.org/wiki/Group_homomorphism) $\operatorname{twist}_f : \operatorname{Stab}(f) \to G \wr P$. To be able to talk about a sequence of twists about different axes, we can define the *twist group* as the [free product (coproduct)](https://en.wikipedia.org/wiki/Free_product) of the groups of twists about each axis:

$$\coprod_{f \in \Gamma} \operatorname{Stab}(f),$$

which comes with a free homomorphism $\operatorname{twist} : \coprod\limits_{f \in \Gamma} \operatorname{Stab}(f) \to G \wr P$, which simply applies multiple twists in sequence.

Often not all puzzle states are reachable by twists. The [image](https://en.wikipedia.org/wiki/Group_homomorphism#Image_and_kernel) of this homomorphism is exactly the set of puzzle states that are. This is a subgroup of $G \wr P$ and is called the *puzzle group*.

Various reasons why the puzzle group is smaller than $G \wr P$ are called [*piece invariants*](/theory/invariants.md). For example, no twist on a cube ever relocates a center, thus in the puzzle group's $\mathbb{Z}_4 \wr S_6$ component, the $S_6$ permutation is always the identity. For more complicated reasons, in the $\mathbb{Z}_2 \wr S_{12}$ component, the sum across all copies of $\mathbb{Z}_2$ must be $0$ -- this is the edge orientation parity.

### Complex puzzles

We do not need to be limited to the pieces that exist on the physical 3×3×3. We can take pieces corresponding to every possible subset of the grip set, thus $P = 2^\Gamma$, which has $2^6 = 64$ pieces. The puzzle you get when you include all the pieces of another puzzle in this sense is called the *complex* version of that puzzle.

The complex 3×3×3 has 10 types of pieces, which include the core, centers, edges, and corners from the 3×3×3. It also includes the double-axles, with active grips like {`R`, `L`}, and the bridges, with active grips like {`R`, `U`, `L`}. The other types of pieces are generated by the *anti-* automorphism of this puzzle. The anti- automorphism takes every piece with active grip set $A$ to the piece whose active grip set is $A^c$, its complement. Given a twist with axis $a$ and transformation $g$, the composition of two actions of the puzzle: the first action is a rotation of every piece by $g^{-1}$, and the second is the original twist. When viewed on an actual 3×3×3, this automorphism maps moves to wide moves of the opposite faces. The anti- version of a piece is the image of a piece under the anti- automorphism. Thus, we can call the other pieces of the complex 3×3×3 anti-edges, anti-double-axles, anti-centers, and the anti-core. Anti-corners and anti-bridges are isomorphic to the corners and bridges, so they do not need to be recounted.

### More puzzles

This definition is immediately generalizable by replacing the set of grips $\Gamma$ and the grip group $G$. For instance, using 12 grips and the grip group of a dodecahedron, we can create a megaminx, and by including all pieces, we can construct the complex megaminx, which has $2^{12} = 4096$ pieces of 96 types[^1].

We can also take 8 grips, `R`, `U`, `F`, `O`, `L`, `D`, `B`, and `I`, with the grip group being the 192 symmetries of the hypercube. This allows us to construct the [3^4^](/puzzles/3x3x3x3.md). One notable feature of this group that is not present in the previous cases is that when we take two adjacent grips (e.g. `R` and `U`), there are non-identity elements of the grip group that fix both of these, even though there are also non-identity elements that only fix one of them. This means that [RKT](/techniques/rkt.md) is possible on this puzzle.

### More layers

More layers can be added to a puzzle by adding more grips. For instance, to build a 5×5×5, we need two grips for every grip of the 3×3×3, which we can call `1R` and `2R`, and similarly for the others. The grip group will act identically on the layer-1 grips and the layer-2 grips, but will not swap them. In this way, either layer of a face of the 5×5×5 can be selected by choosing which grip on that face to use. The complex 5×5×5 can be constructed out of this grip system.

In general, odd-layered puzzles can be constructed with this approach, but even-layered puzzles are less well-defined. They can be constructed like the odd-layered puzzles with one more layer, but this results in identical grip systems and complex variants. Alternatively, we can use stored grips, but this results in less symmetrical puzzles.

### Group automorphisms

There are more automorphisms that these puzzles can have. An inner automorphism of the grip group, which is a conjugate by an element of the group, can be extended to an automorphism of the puzzle by interpreting the inner automorphism as a whole-puzzle rotation. More interesting is what happens when we use a non-inner automorphism. The one we choose should be realizable as conjugation by a permutation of grips, though not necessarily one in the group. We consider the 12-grip complex megaminx. The grip group of this puzzle has an outer automorphism of reflection. By applying this outer automorphism, we obtain a reflection of the whole puzzle, showing that the puzzle is not chiral, even though some pieces are. More interesting is the other outer automorphism of this group, which manifests as an exotic automorphism that takes adjacent grips on the dodecahedron to non-adjacent but non-opposite grips and vice versa. This automorphism is called the *co-* automorphism, and it shows that complex puzzles can have a higher degree of symmetry than the geometric puzzle they were based on.

In general, if we have the grip set $\Gamma$ with group $G$ acting on it, the normalizer $N_{S_\Gamma}(G)$ is the subgroup of the automorphism group of $G$ of automorphisms that can be realized as acting on $\Gamma$. Thus, the *cos* of the grip system are elements of the group $N_{S_\Gamma}(G)/G$. This group is a subgroup of $\operatorname{Out}(G)$, and manifests as additional symmetries of the grip system and the complex puzzle created with it. For example, the cube has two cos: the identity and the reflection. The dodecahedron has four: the identity, the reflection, and the co mentioned above and its inverse. That co applied twice is a reflection, so in a way, it can be considered a square root of the reflection.

### Advanced example

Suppose we have 7 grips, labeled `001`, `010`, `011`, `100`, `101`, `110`, and `111`, which are acted on by $GL_3(\mathbb{F}_2)$ in the standard way. This group has order 168. The action of the grip group on the grips can be thought of as the [Fano plane](https://en.wikipedia.org/wiki/Fano_plane): a *line* is a set of 3 grips where one is the XOR-sum of the other two, and the group is all permutations of the grips that map lines to lines.

With the objects above, we can build the complex puzzle and identify its piece types. First, there is clearly the core, with empty active grips, and 7 centers, with only one active grip each (e.g. {`001`}). Then, among the 15 2-grip pieces, there is only one orbit since the action is 2-transitive, so there is only one piece type, for instance that with active grip set {`001`, `010`}. Among 3-grip pieces, there are only two types: those that contain three grips on a line like {`001`, `010`, `011`}, and those that don't, like {`001`, `010`, `100`}. There are 7 of the former piece type and 28 of the latter type. Finally, for 4-, 5-, 6-, and 7- grip pieces, we can use the anti- automorphism to observe that these pieces are exactly the anti- variants of the 0- through 3-grip pieces. Thus, we have classified all the pieces of the complex Fano plane puzzle.

## Extensions to grip theory

### Infinite grips

Consider a set of grips $\mathbb{Z}^2$, whose grip group are the rotations and translations that preserve the lattice. A puzzle constructed like this would have infinitely many twists, and would be unwieldy. A way to simplify this puzzle is to restrict the axes that twists are allowed on. Now, a grip that is not under an allowed twist is called *stored*. For instance, if twists are only allowed with axes $(0,0)$ and $(1,0)$, you can make a selection of pieces to make a two-circle puzzle like the [Rashkey](https://twistypuzzles.com/cgi-bin/puzzle.cgi?pkey=1447). However, the complex Rashkey would still have uncountably many pieces, many of which can reach infinitely many attitudes. A solution to this is to only allow pieces with finite active grip sets. If the active grip set of a piece is finite and there are only a finite number of allowed axes, each with finitely many transformations corresponding to a turn, the piece can only reach finitely many attitudes, despite the infinitude of the grip group.

### Blocked grips

The 3×3×3 is a doctrinaire puzzle. If a corner {`R`, `U`, `F`} and edge {`R`, `U`} are bandaged together, the puzzle ceases to be doctrinaire. This can be implemented into grip theory by adding a new kind of grip to pieces: *blocked grips*. Blocked grips follow the attitude just like active grips. We remove the corner and edge above and replace them with a new piece with active grips {`R`, `U`} and blocked grips {`F`}. When we apply a twist, if its axis would turn a piece along a blocked grip, the entire twist is illegal in this state. This exactly mimics the bandaging of the 3×3×3, because by removing `F` from the set of active grips of the corner and the set of inactive grips of the edge, it prevent us from performing any twist that would only move one of the two pieces.

### Jumbling

We can combine these two notions. Consider the [curvy copter](https://twistypuzzles.com/cgi-bin/puzzle.cgi?pkey=1574) (ignore overhang bandaging for now). Clearly, it has at least 12 grips, corresponding to the edges of a cube, with a grip group that contains the rotations of a cube acting on them. However, it should also have jumbling moves, rotations of $\arccos\frac{1}{3}$ around one of the 12 allowed axes. If we take the image of all the grips under repeated application of this type of rotation, we end up with a countably infinite dense set of grips with a countably infinite grip group. Each piece of the curvy copter can be compared with every grip to identify its active and bandaged grips. This produces a description of the curvy copter in grip theory. This description can be simplified so there are only finitely many active and bandaged grips per piece.

### Non-faithful actions

In all previous examples, the action on the grip group has been [faithful](https://groupprops.subwiki.org/wiki/Faithful_group_action). However, this does not have to be the case. Consider the rotational symmetry of the cube, the octahedral group. This group is a quotient of the binary octahedral group of order 48, so the binary octahedral group can act on 6 grips via its quotient. The resulting puzzle has the same pieces as the complex 3×3×3, but each piece can have twice as many attitudes, and thus twice as many orientations in a given position. Because the binary octahedral group can be interpreted as a group of spinors, the puzzle with the 3×3×3's pieces but the binary octahedral grip group is the [quaternion cube](https://magmamcfry.github.io/QuaternionCube/).

### Multiplex puzzles

Rather than simply assigning pieces a set of active grips, it is possible to create a set of grips combined with endomorphisms of the transforms associated with each grip. This allows for a puzzle like the 3×3×3 where some pieces perform an `R` while others perform `R2` or `R'`. A full *multiplex* puzzle can be built by including a piece for every combination of these grip-endomorphism pairs for a given set of endomorphisms. A simple example is the Triplex Tetrahedron on [this page](https://sonicpineapple.github.io/Complex-Puzzles/Complex.html).

Of particular note are puzzles using automorphisms of the transforms, as these preserve symmetry between different versions of the same grip. These include combination puzzles like [Entangled 3×3×3s](https://www.youtube.com/watch?v=Gfe_ZTWlSYA).

## Lamination

Lamination is a restriction and generalization of grip theory. It allows fewer types of pieces than are described by grip theory, but the pieces it describes are closer to those of actual puzzles. It has multiple related interpretations.

### Group action interpretation

Suppose, as above, there is a grip group that acts on the set of grips. We now select a [block system](https://en.wikipedia.org/wiki/Block_(permutation_group_theory)) of this action, and each block is called an *axis*. Now, instead of a piece having a selection of active grips, a piece will have a *layer* on each axis, where a layer is an assignment of a symbol (WLOG element of $\mathbb{Z}$) to each grip in that axis. Then, a twist still has an axis, but now it has a selected layer within that axis, as well as a transformation, an element of the grip group, that pointwise stabilizes the axis. A *laminated* puzzle is one that, given a selection of axes an selection of layers on each axis, contains a piece for every combination of layers. In this way, it is similar to complex puzzles.

For instance, to construct a 3×3×3, first start with the 6 grips `R`, `U`, `F`, `L`, `D`, and `B`. Then, let the axes be `x` = {`R`, `L`}, `y` = {`U`, `D`}, and `z` = {`F`, `B`}. We can choose a set of layers for each axis: the layers of `x` will be the assignments {`R`↦0, `L`↦0}, {`R`↦1, `L`↦0}, and {`R`↦0, `L`↦1}, and similarly for `y` and `z`. Since there are 3 layers per axis and 3 axes, the laminated 3×3×3 has $3^3 = 27$ pieces, exactly as many as a 3×3×3. In fact, the laminated 3×3×3 is exactly the super 3×3×3.

### Representation interpretation

Now, we still have a grip group, but instead of acting on a set of grips, it acts linearly on a vector space $V$. The axes are a set of linearly independent subspaces that span $V$ (which implies the $V$ is the direct sum of the axes), and this set should be setwise stabilized by the grip group. A layer is a point in a subspace. A piece as before has one layer per axis, but now, since layers are points in orthogonal subspaces, we can also identify a piece with a point in $V$ whose projections onto the subspaces are its layers. Thus, a twist, being a selection of axis $a$, layer $\lambda$, and transformation $g$, has the effect of selecting all pieces in an affine space passing through $\lambda$ parallel to the direct sum of all axes that are not $a$, and applying $g$ to them.

Constructing the 3×3×3 is even more geometrically intuitive than before. Now, we have three axes `x`, `y`, `z`, which correspond to the three coordinate axes of $\mathbb{R}^3$. The grip group acts on $\mathbb{R}^3$ as the rotational symmetries of the cube, and the layers of `x` will be the surfaces $x=0$, $x=-1$, and $x=1$, and similarly for `y` and `z`. With this approach, the 27 pieces of the laminated 3×3×3 form an arrangement just like that of the actual 3×3×3. However, this approach is not limited to three dimensions, and can be used to construct all the puzzles under doctrinaire grip theory.

### More layers

Laminated puzzles, as the name suggests, are made of layers, so adding more layers is trivial. Moreover, even-layered puzzles can be constructed as naturally as odd-layered ones. This makes them a more natural description of these puzzles.

[^1]: <https://www.gcsu.edu/sites/files/page-assets/node-808/attachments/powers.pdf>
